version: 1

defaults:
  input_schema_ref: schemas/poc/mailbox-envelope.v1.schema.json
  output_schema_ref: schemas/poc/review-result.v1.schema.json
  spawn_policy: per_task_process
  max_concurrency: 1
  lease_ttl_sec: 180
  retry:
    max_attempts: 2
  timeouts:
    soft_sec: 600
    hard_sec: 900

agents:
  - id: codex
    name: Codex Reviewer
    role: reviewer
    provider: codex
    model: gpt-5-codex
    prompt_file: prompts/reviewer/codex.md
    allowed_message_types:
      - task_assignment
      - review_result
    env:
      CODEX_SANDBOX: read-only
      CODEX_MODE: full-auto
    command_template:
      - codex
      - exec
      - --full-auto
      - --sandbox
      - read-only
      - --cd
      - "{repo_root}"
      - "{prompt}"

  - id: claude
    name: Claude Reviewer
    role: reviewer
    provider: claude
    model: sonnet
    prompt_file: prompts/reviewer/claude.md
    allowed_message_types:
      - task_assignment
      - review_result
    command_template:
      - claude
      - -p
      - "{prompt}"

  - id: aggregator
    name: Review Aggregator
    role: aggregator
    provider: local
    model: deterministic-v1
    prompt_file: prompts/reviewer/aggregator.md
    input_schema_ref: schemas/poc/mailbox-envelope.v1.schema.json
    output_schema_ref: schemas/poc/aggregation-result.v1.schema.json
    allowed_message_types:
      - review_result
      - aggregation_result
    spawn_policy: long_running
    max_concurrency: 8
    lease_ttl_sec: 300
    retry:
      max_attempts: 5
    timeouts:
      soft_sec: 30
      hard_sec: 60
    command_template:
      - node
      - dist/aggregator.js

  - id: orchestrator
    name: Control Orchestrator
    role: orchestrator
    provider: local
    model: deterministic-v1
    prompt_file: prompts/reviewer/orchestrator.md
    input_schema_ref: schemas/poc/mailbox-envelope.v1.schema.json
    output_schema_ref: schemas/poc/process-manager-plan.v1.schema.json
    allowed_message_types:
      - task_assignment
      - aggregation_result
      - control
      - error
    spawn_policy: long_running
    max_concurrency: 4
    lease_ttl_sec: 300
    retry:
      max_attempts: 5
    timeouts:
      soft_sec: 30
      hard_sec: 60
    command_template:
      - node
      - dist/orchestrator.js
